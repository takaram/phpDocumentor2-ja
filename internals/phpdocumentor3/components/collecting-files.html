<!DOCTYPE html>

<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <title>Collecting files &mdash; phpDocumentor</title>

    <link rel="stylesheet" href="../../../_static/default.css" type="text/css"/>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css"/>
    <!--<link rel="stylesheet" href="../../../_static/configurationblock.css" type="text/css"/>-->

    <link href="../../../_static/css/template.css" rel="stylesheet" media="all">
    <style>
        h1 {
            font-family: serif;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            color: #333;
        }
        h2:first-of-type {
            margin-top: 25px;
        }
        h2 {
            font-family: serif;
            color: #333;
            border: none;
            font-style: italic;
            margin-top: 15px;
        }
        .well table.docutils {
            width: 100%;
        }
    </style>

    <script src="../../../_static/js/jquery-1.7.1.min.js" type="text/javascript"></script>
    <script src="../../../_static/js/jquery-ui-1.8.2.custom.min.js" type="text/javascript"></script>
    <script src="../../../_static/js/bootstrap.js" type="text/javascript"></script>
    <script src="../../../_static/js/prettify/prettify.min.js" type="text/javascript"></script>
    <script type="text/javascript">

        function equalHeight(group) {
            var tallest = 0;

            group.each(function() {
                var thisHeight = $(this).height();
                if(thisHeight > tallest) {
                    tallest = thisHeight;
                }
            });

            group.height(tallest);
        }

        $(document).ready(function() {
            $('.contents .row').each(function() {
                equalHeight(jQuery(this).find('.well'));
            });

            // remove the classes added by Sphinx; the container class is
            // used in Twitter bootstrap and this collides
            $('.container .container').removeClass('container');
        });
    </script>

    <link rel="shortcut icon" href="http://demo.phpdoc.org/Responsive/img/favicon.ico">
    <link rel="apple-touch-icon" href="http://demo.phpdoc.org/Responsive/img/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="http://demo.phpdoc.org/Responsive/img/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="http://demo.phpdoc.org/Responsive/img/apple-touch-icon-114x114.png">
        <link rel="top" title="phpDocumentor" href="../../../index.html"/> 
</head>
<body>

<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>
            <a class="brand" href="/">phpDocumentor</a>

            <div class="nav-collapse">
                <ul class="nav">
                    <li class="dropdown">
                        <a href="#documentation" class="dropdown-toggle" data-toggle="dropdown"> Documentation<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="/docs"><i class="icon-th"></i> phpDocumentor 2</a></li>
                            <li><a href="http://manual.phpdoc.org"><i class="icon-th"></i> phpDocumentor 1</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#demo" class="dropdown-toggle" data-toggle="dropdown"> Demo<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="http://demo.phpdoc.org/Responsive/"><i class="icon-list-alt"></i> Responsive</a></li>
                        </ul>
                    </li>
                    <li><a href="/templates"><i class="icon-list-alt"></i> Templates</a></li>
                    <li><a href="/contact"><i class="icon-list-alt"></i> Contact</a></li>
                    <li><a href="/about"><i class="icon-list-alt"></i> About</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="go_to_top"><a href="#___" style="color: inherit">Back to top <i class="icon-upload icon-white"></i></a></div>
</div>
<div id="___" class="container">
    <noscript>
        <div class="alert alert-warning">
            Javascript is disabled; several features are only available if Javascript is enabled.
        </div>
    </noscript>

    <div class="row">
        <div class="span3">
        <h3><a href="../../../index.html">Table Of Contents</a>
        </h3>
        <ul>
<li><a class="reference internal" href="#">Collecting files</a><ul>
<li><a class="reference internal" href="#creating-a-filesystem-entity">Creating a Filesystem entity</a><ul>
<li><a class="reference internal" href="#what-is-a-dsn">What is a DSN</a></li>
<li><a class="reference internal" href="#id1">Creating a Filesystem Entity</a></li>
</ul>
</li>
<li><a class="reference internal" href="#flysystem-finder-plugin">Flysystem Finder Plugin</a></li>
<li><a class="reference internal" href="#specifications-for-the-finder">Specifications for the Finder</a></li>
</ul>
</li>
</ul>

        <div id="searchbox" style="display: none">
            <h3>Search</h3>

            <form class="search" action="../../../search.html" method="get">
                <input type="text" name="q" size="18"/>
                <input type="submit" value="Go"/>
                <input type="hidden" name="check_keywords" value="yes"/>
                <input type="hidden" name="area" value="default"/>
            </form>
        </div>
        <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
        <div class="span9 contents">
            <div class="breadcrumb">
<div class="related">
    <h3>Navigation</h3>
    <ul>
        <li class="right" style="margin-right: 10px; margin-top: 6px;">
            <a href="../../../genindex.html" title="General Index" accesskey="I">
                index
            </a>
        </li>
        <li>
            <a href="http://www.phpdoc.org">Homepage</a>  &raquo;
        </li>
        <li>
            <a href="../../../index.html">Documentation</a>  &raquo;
        </li> 
    </ul>
</div>
            </div>

            
            <div class="well">
            

            
  <div class="section" id="collecting-files">
<h1>Collecting files<a class="headerlink" href="#collecting-files" title="Permalink to this headline">¶</a></h1>
<p>Document Groups need to retrieve a series of physical files that can be parsed and transformed into the Documentation
structure. In order to achieve this we need a Service that consumes and configures Flysystem based on a DSN. After that
it uses a series of SPECIFICATIONS to collect one or more files.</p>
<blockquote>
<div>This functionality replaces phpDocumentor’s Fileset component. The Fileset component suffers from problems when it
comes to testing large folder structures of which most is ignore (for example, a source folder containing a
‘vendor’ folder; the vendor folder should not even be checked but the Symfony Finder will still retrieve all files.
This causes delays of up to 10 seconds). Another benefit of this new system is that it will allow the user to load
files from remote locations, such as github.</div></blockquote>
<img alt="../../../_images/file-collection.png" src="../../../_images/file-collection.png" />
<p>In the Class Diagram above you can see the concepts that need to be realized. Technically speaking this is separated
into three parts:</p>
<ol class="arabic simple">
<li>Creating a Filesystem entity using a Factory</li>
<li>Creating a Flysystem plugin to add File finding capabilities to the Filesystem entity</li>
<li>Adding Specification classes to apply when finding files using the <cite>find()</cite> method introduced by the previous plugin</li>
</ol>
<div class="section" id="creating-a-filesystem-entity">
<h2>Creating a Filesystem entity<a class="headerlink" href="#creating-a-filesystem-entity" title="Permalink to this headline">¶</a></h2>
<p>Flysystem provides an entity named Filesystem that perfectly represents a Filesystem entity that we want to use with
phpDocumentor to find and read files.</p>
<p>Flysystem however has no method to create a Filesystem entity (and its storage adapter) using a DSN string; as such we
need to create our own Factory to provide for that.</p>
<div class="section" id="what-is-a-dsn">
<h3>What is a DSN<a class="headerlink" href="#what-is-a-dsn" title="Permalink to this headline">¶</a></h3>
<p>A DSN (Data Source Name) is a string that identifies the type and location of a Data Source. Although there is no
standardized format for a DSN we are going to base ours on RFC 3986, the representation of a URI. Because we need to
be able to provide parameters to the DSN we are going to amend the RFC 3986 with a parameter notation (that is
supported by RFC 3986).</p>
<p>Let’s show a few examples:</p>
<ul class="simple">
<li>git+http://github.com/phpDocumentor/phpDocumentor2;branch=develop</li>
<li><a class="reference external" href="file://src">file://src</a></li>
<li>src</li>
</ul>
<p>In the first example you can see that we want to parse a git location using the http protocol (git supports
multiple protocols) where the repository is located at github.com/phpDocumentor/phpDocumentor2 with the parameter
branch that has value &#8216;develop&#8217;.</p>
<p>In the second and third example we see a simple example of a DSN that points towards the relative path ‘src’ on the
local filesystem.</p>
<blockquote>
<div>Please note that this is relative to the configuration file or if the path is provided on the command line to the
current working directory.</div></blockquote>
<p>This does mean that if there is no scheme (the <cite>file://</cite> part) that <cite>file://</cite> is assumed for simplicity.</p>
<p>Php has a utility function named <cite>parse_url</cite> that can be used to parse the DSN; some tweaks are however necessary.
Examples of this are splitting the parameters off first because parse_url does not understand the <cite>;</cite> character and
when the <cite>file://src</cite> DSN is used that src is not a hostname but a path (due to the <cite>file://</cite>, local files don’t have
a hostname). This is parsing should be done in the DSN Value Object.</p>
</div>
<div class="section" id="id1">
<h3>Creating a Filesystem Entity<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The FilesystemFactory is responsible for converting a DSN object into a Filesystem Entity (including the right
adapter) and adding the newly created <cite>phpDocumentorFlysystemFinderPlugin</cite> plugin onto it (see the next chapter for
more information on this Plugin).</p>
<p>In the class diagram you can see that the Flysystem Mount Manager is required by the FilesystemFactory. We can use this
to store and retrieve created Filesystem objects so that we do not have to recreate it if a DSN is used twice. A hash
of the DSN can be used as an identifier internal to the FilesystemFactory for a Filesystem Entity.</p>
<p>Part of creating a Filesystem Entity is selecting and creating the right Flysystem Adapter to use and applying the
correct decorators. Because Flysystem adapters can depend on any number of dependencies we will be injecting the
Container so that the dependencies for an Adapter can be retrieved.</p>
<blockquote>
<div>Usually you would create an AdapterFactory to create the adapters, and have that query the container for
dependencies, but in this instance I have chosen not to to keep the architecture simpler and because I do not
think phpDocumentor should care about Adapters in its Domain Model. A Filesystem object is however a Domain Model
concept, even if it is part of Flysystem (which belongs to the Infrastructure Layer).</div></blockquote>
<p>In order to determine which Adapter, decorator and plugins should be created we can examine the ‘Scheme’ of the DSN.
This determines the type of transport and thus which adapter should be created.</p>
<p>Initially we will be supporting three schemes:</p>
<ol class="arabic simple">
<li><cite>file</cite> – the local file system, which is represented by the ‘Local’ Adapter</li>
<li><cite>git+http</cite> – A git repository that is cloned in the ‘tmp’ folder, this is represented by the ‘CloneRemoteGitToLocal’
adapter (<a class="reference external" href="https://github.com/potherca/flysystem-readonly-git-adapter">https://github.com/potherca/flysystem-readonly-git-adapter</a>)</li>
<li><cite>git+https</cite> – which is an alias for <cite>git+http</cite> only we connect over https instead of http.</li>
</ol>
<p>After the Adapter and Filesystem is created we need to add the Flysystem Finder Plugin onto the Filesystem entity, as
described in the next chapter, as that will add search capabilities to the Flysystem.</p>
</div>
</div>
<div class="section" id="flysystem-finder-plugin">
<h2>Flysystem Finder Plugin<a class="headerlink" href="#flysystem-finder-plugin" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="specifications-for-the-finder">
<h2>Specifications for the Finder<a class="headerlink" href="#specifications-for-the-finder" title="Permalink to this headline">¶</a></h2>
</div>
</div>



            
            </div>
            
        </div>
    </div>

  <div class="row">
    <footer class="span12">
        <p>
            Created using <a
                href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2.
        </p>
    </footer>
  </div>
</div>

</body>
</html>